<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>About</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">2022 World Cup</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="About.html">About</a>
</li>
<li>
  <a href="https://stephanteodosescu.com/">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/steodosescu">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/steodose/F1">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://betweenpipes.wordpress.com/">
    <span class="fa fa-wordpress fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">About</h1>

</div>


<p>This website is an experimental/hobbyist project, and your home for everything 2022 World Cup analytics.</p>
<div id="calculating-individual-match-outcomes" class="section level2">
<h2>Calculating Individual Match Outcomes</h2>
<p>From a high level the model works as follows: We identify the goal scoring and conceding rates of each team, then use these ratings to forecast the expected number of goals to be scored in matches that haven’t taken place yet. These expected goals are used to calculate the probabilities of the various outcomes (home win, draw, away win), which assumes the number of goals scored in soccer follow a Poisson distribution. From there we simulate these results with the predicted probabilities 10,000 times to identify the most likely outcomes for the season.</p>
<p>The first step in the analysis is to get match data and create arrays with the games played thus far into the season. I’m using data from the fantastic <a href="http://www.football-data.co.uk">football-data.co.uk</a> website. To create odds for each match outcome in the season, I’m using Mark Taylor’s approach by creating match result probabilities <a href="http://thepowerofgoals.blogspot.com.cy/2016/02/how-to-frame-individual-match-outcome.html">described here</a> using historical goals scored. He uses Expected Goals to create these odds, but I’ve substituted that with publicly available Actual Goals. This method works better the deeper we are into the season as variance from teams’ true finishing ability vs their goal figures evens out of the course of the year.</p>
<p>As described by Taylor, the method uses 1) the average number of goals scored by home and away teams in the given campaign and 2) The average number of goals scored and conceded by the two teams in question in any match. As an example, let’s do this analysis for a single match: Burnley at home vs. Liverpool. And let’s say Home teams are scoring 0.25 goals per game more than visitors – 1.49 compared to 1.24, and the average game has 1.37 expected goals per team.</p>
<p>Note GS = Goals Scored and GC = Goals Conceded in the table below.</p>
<table style="width:100%;">
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th>Avg GS by Home Teams</th>
<th>Avg GS by Away Teams</th>
<th>Avg GS/GC by all teams</th>
<th>Avg GS by Burnley</th>
<th>Avg GC by Burnley</th>
<th>Avg GS by Liverpool</th>
<th>Avg GC by Liverpool</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.49</td>
<td>1.24</td>
<td>1.37</td>
<td>1.09</td>
<td>1.91</td>
<td>1.92</td>
<td>1.16</td>
</tr>
</tbody>
</table>
<p>This means we expect Burnley to score 1.00 goal and Liverpool 2.43 goals in an upcoming game. The math to get there: Burnley are scoring an average of 1.09 goals per match, thus are scoring (1.09/1.37) = 0.79times the rate of average scoring in the competition. Liverpool allow 1.16/1.37 or 0.85 times the rate of conceding in the competition. Burnley are at home and home teams score 1.49/1.37 or 1.09 times the average rate for this year’s campaign. Thus, multiplying these rates together, Burnley are expected to score 0.79 * 0.85 * 1.09 * 1.37 = 1.0 goals in this matchup. Likewise we can do the same for Liverpool:</p>
<p>Liverpool score 1.92/1.37 = 1.40</p>
<p>Burnley allow 1.91/1.37 = 1.39 times league average.</p>
<p>Away teams score 1.24/1.37 = 0.91 times league average.</p>
<p>Liverpool are likely to score 1.40 * 1.39 * 0.91 * 1.37 expected goals = 2.43 expected goals.</p>
<p>Goals scoring in soccer is known to follow a Poisson distribution. Thus if we plug these figures into a Poisson model, we get the following match predictions</p>
<table>
<thead>
<tr class="header">
<th>Burnley Win</th>
<th>Draw</th>
<th>Liverpool Win</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>14%</td>
<td>18%</td>
<td>64%</td>
</tr>
</tbody>
</table>
</div>
<div id="simulating-all-season-fixtures" class="section level2">
<h2>Simulating all season fixtures</h2>
<p>The above shows how we get to probabilities for individual match outcomes. Next, we use these outcomes to simulate an entire season…10,000 times. For this model we’re using independent Poisson distributions to simulate results from. Based on the model estimates for single matches, Monte-Carlo simulations are then used to estimate probabilities for reaching the different stages in the tournament for all teams.</p>
</div>
<div id="visualizing-the-results" class="section level2">
<h2>Visualizing the results</h2>
<p>Using the <code>df.all</code> output dataframe we can create myriad data visualizations to show the range of outcomes for each Premier League team. I use the Tidyverse Googlesheets API to write this dataset to Google Sheets so we can subsequently use Tableau’s Web Data Connector functionality to layer on visualizations in Tableau. We can use the CronR addin for RStudio to schedule our R script to run on a defined weekly cadence to ensure we have the latest league results accounted for.</p>
<p>In addition, we can create a few graphs in R as well. This one was generated as of Matchweek 9<img src="FIFA%20World%20Cup%20Rankings%20Table%20with%20Logo.png" alt="This one was generated pre-tournament" />.</p>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>The data come from <a href="http://www.football-data.co.uk/">football-data.co.uk</a>, and is refreshed after all the games have been completed for the week, usually on Mondays.</p>
</div>
<div id="learn-more" class="section level2">
<h2>Learn More</h2>
<p>You can read more at my blog <a href="https://betweenpipes.wordpress.com/">Between the Pipes</a>.</p>
<hr />
</div>
<div id="resources-and-inspiration" class="section level2">
<h2>Resources and Inspiration</h2>
<p>The below resources were used to access Formula 1 data and create the tables and plots you see on this site. It was created exclusively using R, a language for statistical programming. Many thanks to all the authors of these fantastic resources:</p>
<table>
<colgroup>
<col width="16%" />
<col width="16%" />
<col width="66%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Title/Link</th>
<th align="left">Author</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="https://r4ds.had.co.nz/">R for Data Science</a></td>
<td align="left">Hadley Wickham, Garret Grolemund</td>
<td align="left">A great overview of the <code>tidyverse</code>, covers everything from reading data in, data manipulation/summarization, data viz, and general programming in R</td>
</tr>
<tr class="even">
<td align="left"><a href="http://ergast.com/mrd/">Ergast API</a></td>
<td align="left">Chris Newell</td>
<td align="left">The ergast experimental Motor Racing Developer API provides a historical record of Formula One results data dating back to 1950.</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://rmarkdown.rstudio.com/lesson-1.html">R Markdown Intro Guide</a></td>
<td align="left">R Studio</td>
<td align="left">Intro primer to authoring R Markdown documents.:</td>
</tr>
<tr class="even">
<td align="left"><a href="http://www.cookbook-r.com/Graphs/"><code>ggplot2</code> Cookbook</a></td>
<td align="left">Winston Chang</td>
<td align="left">Quick cookbook of <code>ggplot2</code> plots</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://www.p8105.com/making_websites.html">Making Websites in R Markdown</a></td>
<td align="left">Jeff Goldsmith</td>
<td align="left">Nice introduction from his course at Columbia on how to make websites using only R and Rstudio.</td>
</tr>
<tr class="even">
<td align="left"><a href="https://bookdown.org/yihui/rmarkdown/">R Markdown Book</a></td>
<td align="left">Yihui Xie, J. J. Allaire, Garrett Grolemund</td>
<td align="left">The definitive guide outlining what you can do with the rmarkdown package (Allaire, Xie, McPherson, et al. 2021), which was first created in early 2014. The package has steadily evolved into a complete ecosystem for authoring documents in a variety of output formats including the output of this document that you’re reading.</td>
</tr>
</tbody>
</table>
</div>

<p>Copyright &copy; 2021 Stephan Teodosescu</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
